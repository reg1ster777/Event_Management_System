<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>管理员登录 - 校园活动管理系统</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .login-card {
            background: #ffffff;
            padding: 28px 24px 24px;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            width: 420px;
            box-sizing: border-box;
        }

        .login-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
            text-align: center;
        }

        .login-subtitle {
            font-size: 13px;
            color: #888;
            text-align: center;
            margin-bottom: 18px;
        }

        .tabs {
            display: flex;
            margin-bottom: 12px;
            border-radius: 999px;
            background: #f3f3f3;
            padding: 2px;
        }

        .tab {
            flex: 1;
            text-align: center;
            font-size: 13px;
            padding: 6px 0;
            border-radius: 999px;
            cursor: pointer;
            user-select: none;
        }

        .tab.active {
            background: #1677ff;
            color: #fff;
            box-shadow: 0 3px 8px rgba(22, 119, 255, 0.3);
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 4px;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            box-sizing: border-box;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            outline: none;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            border-color: #1677ff;
            box-shadow: 0 0 0 2px rgba(22, 119, 255, 0.15);
        }

        .btn {
            width: 100%;
            padding: 9px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            background: #1677ff;
            color: white;
            transition: background 0.15s ease, box-shadow 0.15s ease;
        }

        .btn:hover {
            background: #165fcc;
            box-shadow: 0 4px 10px rgba(22, 119, 255, 0.35);
        }

        .btn:disabled {
            background: #a0c4ff;
            cursor: not-allowed;
            box-shadow: none;
        }

        .message {
            margin-top: 8px;
            font-size: 12px;
            min-height: 18px;
        }

        .message.error {
            color: #d93025;
        }

        .message.success {
            color: #0b9a42;
        }

        .footer-tip {
            margin-top: 10px;
            font-size: 12px;
            color: #aaa;
            text-align: center;
        }

        .footer-tip a {
            color: #1677ff;
            text-decoration: none;
        }

        .footer-tip a:hover {
            text-decoration: underline;
        }

        .hint {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }
    </style>
</head>
<body>
<div class="login-card">
    <div class="login-title">管理员入口</div>
    <div class="login-subtitle">高校学生活动全流程管理系统</div>

    <!-- 登录 / 注册 选项卡 -->
    <div class="tabs">
        <div id="tab-login" class="tab active">登录</div>
        <div id="tab-register" class="tab">注册</div>
    </div>

    <!-- 登录表单 -->
    <section id="section-login" class="section active">
        <form id="login-form">
            <div class="form-group">
                <label for="login-username">用户名</label>
                <input id="login-username" name="username" type="text" placeholder="请输入管理员用户名" required>
            </div>

            <div class="form-group">
                <label for="login-password">密码</label>
                <input id="login-password" name="password" type="password" placeholder="请输入密码" required>
            </div>

            <button id="login-btn" type="submit" class="btn">登录</button>

            <div id="login-message" class="message"></div>
        </form>
    </section>

    <!-- 注册表单 -->
    <section id="section-register" class="section">
        <form id="register-form">
            <div class="form-group">
                <label for="reg-username">用户名</label>
                <input id="reg-username" name="username" type="text" placeholder="请输入用户名" required>
            </div>

            <div class="form-group">
                <label for="reg-password">密码</label>
                <input id="reg-password" name="password" type="password" placeholder="请输入密码" required>
            </div>

            <div class="form-group">
                <label for="reg-password2">确认密码</label>
                <input id="reg-password2" name="password2" type="password" placeholder="再次输入密码" required>
                <div class="hint">当前仅用于课程实验，不涉及密码加密与复杂校验。</div>
            </div>

            <!-- 角色暂时写死为 admin，也可以做成下拉框 -->
            <input id="reg-role" type="hidden" value="admin">

            <button id="register-btn" type="submit" class="btn">注册管理员</button>

            <div id="register-message" class="message"></div>
        </form>
    </section>

    <div class="footer-tip">
        登录接口：<code>POST /admin/login</code> ，注册接口：<code>POST /admin/create</code>。<br>
        <a href="/index.html">返回首页</a>
    </div>
</div>

<script>
    // tab 切换
    const tabLogin = document.getElementById('tab-login');
    const tabRegister = document.getElementById('tab-register');
    const sectionLogin = document.getElementById('section-login');
    const sectionRegister = document.getElementById('section-register');

    tabLogin.addEventListener('click', () => {
        tabLogin.classList.add('active');
        tabRegister.classList.remove('active');
        sectionLogin.classList.add('active');
        sectionRegister.classList.remove('active');
    });

    tabRegister.addEventListener('click', () => {
        tabRegister.classList.add('active');
        tabLogin.classList.remove('active');
        sectionRegister.classList.add('active');
        sectionLogin.classList.remove('active');
    });

    // 登录逻辑
    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const loginMsg = document.getElementById('login-message');

    loginForm.addEventListener('submit', async function (event) {
        event.preventDefault();

        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;

        if (!username || !password) {
            showMessage(loginMsg, '用户名和密码不能为空', 'error');
            return;
        }

        loginBtn.disabled = true;
        showMessage(loginMsg, '正在登录，请稍候...', '');

        try {
            const response = await fetch('/admin/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (response.ok) {
                const user = await response.json();
                showMessage(loginMsg, `登录成功！欢迎你，${user.username}（角色：${user.role}）`, 'success');

                // 把当前管理员信息保存到 localStorage，供 admin-activities.html 使用
                localStorage.setItem('adminUser', JSON.stringify(user));

                // 登录成功后跳转到后台活动管理页
                setTimeout(() => {
                    window.location.href = '/admin-activities.html';
                }, 800);
            } else if (response.status === 401) {
                showMessage(loginMsg, '用户名或密码错误，请重试。', 'error');
            } else {
                const text = await response.text();
                showMessage(loginMsg, '登录失败，状态码：' + response.status + '，详情：' + text, 'error');
            }
        } catch (error) {
            console.error(error);
            showMessage(loginMsg, '登录请求失败，请检查后端是否启动。', 'error');
        } finally {
            loginBtn.disabled = false;
        }
    });

    // 注册逻辑
    const registerForm = document.getElementById('register-form');
    const registerBtn = document.getElementById('register-btn');
    const registerMsg = document.getElementById('register-message');

    registerForm.addEventListener('submit', async function (event) {
        event.preventDefault();

        const username = document.getElementById('reg-username').value.trim();
        const password = document.getElementById('reg-password').value;
        const password2 = document.getElementById('reg-password2').value;
        const role = document.getElementById('reg-role').value || 'admin';

        if (!username || !password || !password2) {
            showMessage(registerMsg, '请填写完整信息。', 'error');
            return;
        }
        if (password !== password2) {
            showMessage(registerMsg, '两次输入的密码不一致。', 'error');
            return;
        }

        registerBtn.disabled = true;
        showMessage(registerMsg, '正在提交注册请求...', '');

        try {
            const response = await fetch('/admin/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password, role })
            });

            if (response.ok) {
                const user = await response.json();
                showMessage(registerMsg, '注册成功！新管理员 ID = ' + user.userId + '，可以切换到“登录”标签进行登录。', 'success');
            } else {
                const text = await response.text();
                showMessage(registerMsg, '注册失败，状态码：' + response.status + '，详情：' + text, 'error');
            }
        } catch (error) {
            console.error(error);
            showMessage(registerMsg, '注册请求失败，请检查后端服务。', 'error');
        } finally {
            registerBtn.disabled = false;
        }
    });

    // 通用提示函数
    function showMessage(dom, text, type) {
        dom.textContent = text || '';
        dom.className = 'message';
        if (type === 'error') dom.classList.add('error');
        if (type === 'success') dom.classList.add('success');
    }
</script>
</body>
</html>
